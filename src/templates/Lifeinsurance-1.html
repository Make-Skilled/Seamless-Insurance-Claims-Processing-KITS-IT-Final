<?php
session_start(); // Start the session to retrieve the saved data

// Database connection
$host = "localhost";
$dbUser = "root";
$dbPass = "";
$dbName = "submission_system";

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbName;charset=utf8", $dbUser, $dbPass);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("Failed to connect to database: " . $e->getMessage());
}

// Fetch user data from session
if (!isset($_SESSION['user_details'])) {
    echo "No user data found!";
    exit();
}

$userDetails = $_SESSION['user_details'];

// Fetch police submission data from the database
try {
    $stmtPolice = $pdo->query("SELECT * FROM police_details");
    $policeDetails = $stmtPolice->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $policeDetails = [];
    $_SESSION['error'] = "Error fetching police details: " . $e->getMessage();
}

?>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View User, Police & Hospital Details</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(60deg, #3a9bdc, #cbb0b0);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    /* Header Style */
    .header {
      width: 100%;
      background-color: #fff;
      padding: 15px 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      /* Space between logo and links */
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 100;
    }

    .navbar-brand {
      font-size: 1.5rem;
      font-weight: bold;
      color: #0056b3;
      display: flex;
      align-items: center;
    }

    .navbar-brand img {
      width: 30px;
      height: auto;
      margin-right: 10px;
    }

    /* Centered Navigation Links */
    .navbar-nav {
      display: flex;
      justify-content: center;
      flex: 1;
    }

    .navbar-nav a {
      text-decoration: none;
      padding: 10px 20px;
      color: #333;
      font-size: 1.1rem;
      margin: 0 15px;
      border-radius: 5px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .navbar-nav a:hover {
      background-color: #0056b3;
      color: white;
    }

    /* Admin Content */
    .admin-container {
      margin-top: 100px;
      width: 90%;
      max-width: 1200px;
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    /* Section Styles */
    .details-section {
      margin-bottom: 30px;
    }

    /* Police & Hospital Table */
    table {
      width: 100%;
      border: 1px solid #ccc;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table th,
    table td {
      padding: 8px;
      text-align: left;
      border: 1px solid #ccc;
    }

    table th {
      background-color: #007bff;
      color: white;
    }

    .back-button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    .back-button:hover {
      background-color: #45a049;
    }
  </style>
</head>

<body>

  <!-- Header with Logo and Navigation Links -->
  <div class="header">
    <!-- Logo on the Left -->
    <a href="index.html" class="navbar-brand">
      <img src="static/img/icon/icon-02-primary.png" alt="Logo">
      Insurance
    </a>

    <!-- Navigation Links in the Center -->
    <div class="navbar-nav">
      <a href="index.html">Home</a>
      <a href="about.html">About Us</a>
      <a href="service.html">Services</a>
      <a href="contact.html">Contact Us</a>
    </div>
  </div>
  <!-- Main Admin Content -->
  <div class="admin-container">
    <h2>User Submitted Details</h2>
    <div class="details-section">
      <h3>User Details:</h3>
      <p><strong>Username:</strong>
        <?php echo $userDetails['username']; ?>
      </p>
      <p><strong>Policy ID:</strong>
        <?php echo $userDetails['policy_id']; ?>
      </p>
      <p><strong>Aadhaar Number:</strong>
        <?php echo $userDetails['aadhaar_number']; ?>
      </p>
      <p><strong>Phone Number:</strong>
        <?php echo $userDetails['phone_number']; ?>
      </p>
    </div>

    <div class="details-section">
      <h3>Nominee Details:</h3>
      <p><strong>Nominee Name:</strong>
        <?php echo $userDetails['nominee_name']; ?>
      </p>
      <p><strong>Nominee Aadhaar:</strong>
        <?php echo $userDetails['nominee_aadhaar']; ?>
      </p>
      <p><strong>Nominee Phone:</strong>
        <?php echo $userDetails['nominee_phone']; ?>
      </p>
    </div>

    <div class="details-section">
      <h3>Bank Details:</h3>
      <p><strong>Bank Name:</strong>
        <?php echo $userDetails['bank_name']; ?>
      </p>
      <p><strong>Account Number:</strong>
        <?php echo $userDetails['account_number']; ?>
      </p>
      <p><strong>IFSC Code:</strong>
        <?php echo $userDetails['ifsc_code']; ?>
      </p>
    </div>

    <!-- Police Data Section -->
    <h2>Police Submission Details</h2>
    <table>
      <tr>
        <th>Policy ID</th>
        <th>Full Name</th>
        <th>Contact Info</th>
        <th>Uploaded Photo</th>
      </tr>
      <?php foreach ($policeDetails as $police): ?>
      <tr>
        <td>
          <?php echo htmlspecialchars($police['policy_id']); ?>
        </td>
        <td>
          <?php echo htmlspecialchars($police['full_name']); ?>
        </td>
        <td>
          <?php echo htmlspecialchars($police['contact_info']); ?>
        </td>
        <td><a href="<?php echo htmlspecialchars($police['user_photo']); ?>" target="_blank">View Photo</a></td>
      </tr>
      <?php endforeach; ?>
    </table>

    <!-- Hospital Data Section -->
    <h2>Hospital Submission Details</h2>
    <table>
      <tr>
        <th>Policy ID</th>
        <th>Patient Name</th>
        <th>Contact Info</th>
        <th>Medical Report</th>
      </tr>
      <?php foreach ($hospitalDetails as $hospital): ?>
      <tr>
        <td>
          <?php echo htmlspecialchars($hospital['policy_id']); ?>
        </td>
        <td>
          <?php echo htmlspecialchars($hospital['patient_name']); ?>
        </td>
        <td>
          <?php echo htmlspecialchars($hospital['contact_info']); ?>
        </td>
        <td><a href="<?php echo htmlspecialchars($hospital['medical_report']); ?>" target="_blank">View Report</a></td>
      </tr>
      <?php endforeach; ?>
    </table>

    <button class="back-button" onclick="window.history.back();">Back to User Form</button>
  </div>

</body>

</html>